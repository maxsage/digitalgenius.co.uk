<!DOCTYPE HTML>
<html>
<head>
    <title></title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="../csharp.css" />
    <link rel="stylesheet" type="text/css" href="../master.css" />
</head>
<body>
<h1>Building and Analyzing your First EDM</h1>
<p>Now that you have a better understanding of what the ADO.NET Entity Framework is attempting to
accomplish, as well as a high-level idea of how it all works, it’s time to look at your first full example. To
keep things simple for now, you will build an EDM that only allow access to the Inventory table of
AutoLot. Once you understand the basics, you will build a new EDM that accounts for the entire AutoLot
database, and then display your data in a graphical user interface.</p>
<h2>Generating the *.edmx File</h2>
<p>Begin by creating a new Console Application named InventoryEDMConsoleApp. When you wish to use the
Entity Framework, your first step is to generate the necessary conceptual, logical, and physical model
data defined by the *.edmx file. One way to do this is to use the .NET 4.0 SDK command line tool,
EdmGen.exe. Open a Visual Studio 2010 Command Prompt and enter the following instruction:</p>
<pre class="csharpcode">
EdmGen.exe -?</pre>
<p>You should see a list of options that you can supply to the tool to generate the necessary files based
on an existing database; you should also see options to generate a brand new database based on existing
entity files! Table 23-3 documents some common options of EdmGen.exe.</p>
<p><b>Table 23-3.</b> Common command-line flags of EdmGen.exe</p>
<table class="gridtable">
  <tr>
   <th>
    EdmGen.exe Option
   </th>
   <th>
    Meaning in Life
   </th>
  </tr>
  <tr>
   <td>
    /mode:FullGeneration
   </td>
   <td>
    Generate the *.ssdl, *.msl, *.csdl files and client entities from a specified
database.
   </td>
  </tr>
  <tr>
   <td>
    /project:
   </td>
   <td>
    This is the base name to be used for the generated code and files. Typically, this
is the name of the database you pull data from (it can use the short form, /p:).
   </td>
  </tr>
  <tr>
   <td>
    /connectionstring:
   </td>
   <td>
    This is the connection string you use to interact with the database (it can use
the short form, /c:).
   </td>
  </tr>
  <tr>
   <td>
    /language:
   </td>
   <td>
    Allows you to specify whether you wish to use C# or VB syntax for the generated
code.
   </td>
  </tr>
  <tr>
   <td>
    /pluralize
   </td>
   <td>
    Automatically pluralize or singularize the entity set name, entity type name, and
navigation property name using English language rules.
   </td>
  </tr>
</table>
<p>As of .NET 4.0, the EF programming model supports domain first programming, which allows you to
create your entities (with typical object-oriented techniques) and use them to generate a brand new
database. In this introductory look at ADO.NET EF, you will not use this model-first mentality, nor will
you use EdmGen.exe to generate your client-side entity model. Instead, you will use the graphical EDM
designers of Visual Studio 2010.</p>
<p>Now activate the Project &gt; Add New Item... menu option and insert a new ADO.NET Entity Data
Model item (see Figure 23-7) named InventoryEDM.edmx.</p>
<img src="../Images/Figure23_07.png" alt="Figure 23-7" />
<p><b>Figure 23-7</b> Inserting a new ADO.NET EDM project item</p>
<p>Clicking the Add button launches the Entity Model Data Wizard. The wizard’s first step allows you to
select whether you wish to generate an EDM from an existing database or define an empty model (for
model-first development). Select the Generate from database option and click the Next button (see
Figure 23-8).</p>
<img src="../Images/Figure23_08.png" alt="Figure 23-8" />
<p><b>Figure 23-8</b> Generating an EDM from an existing database</p>
<p>You can select your database in the wizard’s second step. If you already have a connection to a
database within the Visual Studio 2010 Server Explorer, you will see it listed in the dropdown combo box.
If this is not the case, you can click the New Connection button. Either way, pick your AutoLot database,
and then make certain you save the connection string data in the (autogenerated) App.config file
(Figure 23-9).</p>
<img src="../Images/Figure23_09.png" alt="Figure 23-9" />
<p><b>Figure 23-9</b> Selecting the database to generate the EDM from</p> 
<p>Before you click the Next button, take a moment to examine the format of your connection string:</p>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
metadata=res://*/InventoryEDM.csdl|res://*/InventoryEDM.ssdl|res://*/InventoryEDM.msl;
    provider=System.Data.SqlClient;provider connection string=
    "Data Source=(local)\SQLEXPRESS;
    Initial Catalog=AutoLot;Integrated Security=True;Pooling=False"</pre>
<p>The point of interest here is the metadata flag, which you use to denote the names of the embedded
XML resource data for your conceptual, physical, and mapping files (recall that the single *.edmx file will
be broken into three separate files at compile time, and the data in these files takes the form of binary
resources embedded in your assembly).</p>
<p>In the wizard’s final step, you can select the items from the database you wish to use to generate the
EDM. Again, you are only concerned with the Inventory table in this example (Figure 23-10).</p>
<img src="../Images/Figure23_10.png" alt="Figure 23-10" />
<p><b>Figure 23-10</b> </p>
<p>Now, click the Finish button to generate your EDM data.</p>
<h2>Reshaping the Entity Data</h2>
<p>Once you complete the wizard, you will see the EDM designer open within the IDE, where you should
see a single entity named Inventory. You can view the composition of any entity on the designer using
the Entity Data Model Browser window (you open this using the View &lt; Other Windows menu option).
Now look at the format of your conceptual model for the Inventory database table under the Entity
Types folder (see Figure 23-11). You can see the physical model of the database under the Store node,
where the name of your store will be based on the name of the database itself (AutoLotModel.Store, in
this case).</p>
<img src="../Images/Figure23_11.png" alt="Figure 23-11" />
<p><b>Figure 23-11</b> The Entity designer and Model Browser window</p>
<p>By default, the names of your entities will be based on the original database object names; however,
recall that the names of entities in your conceptual model can be anything you choose. You can change
the entity name, as well as property names of the entity, by selecting an item on the designer and
renaming it using the Name property in the Visual Studio 2010 Properties window. Next, rename the
Inventory entity to Car and the PetName property to CarNickname (see Figure 23-12).</p>
<img src="../Images/Figure23_12.png" alt="Figure 23-12" />
<p><b>Figure 23-12</b> Reshaping entities using the Properties window</p>
<p>At this point, your conceptual model should look similar to what is shown in Figure 23-13.</p>
<img src="../Images/Figure23_13.png" alt="Figure 23-13" />
<p><b>Figure 23-13</b> The client side model, reshaped to match your business domain</p>
<p>Now select the entire Car entity on the designer and look at the Properties window again. You
should see that the Entity Set Name field has also been renamed from Inventories to Cars (see
Figure 23-14). The Entity Set value is important because this corresponds to the name of the property on
the data context class, which you will use to modify the database. Recall that this property encapsulates
an ObjectSet&lt;T&gt; member variable in the ObjectContext derived class.</p>
<img src="../Images/Figure23_14.png" alt="Figure 23-14" />
<p><b>Figure 23-14</b> The name of the ObjectSet&lt;T&gt; property wrapper</p>
<p>Before moving on, compile your application; doing so refreshes your code base and generates the
*.csdl, *.msl, and *.ssdl files based on your *.edmx file data.</p>
<h2>Viewing the Mappings</h2>
<p>Now that you have reshaped the data, you can view the mappings between the conceptual layer and the
physical layer using the Mapping Details window (you open this using the View &gt; Other Windows...
menu option). Next, look at Figure 23-15 and notice how the nodes on the left-hand side of the tree
represent the data names in the physical layer, while the nodes on the right-hand side represent the
names of your conceptual model.</p>
<img src="../Images/Figure23_15.png" alt="Figure 23-15" />
<p><b>Figure 23-15</b> The Mapping Details window shows the mappings of your conceptual and physical models</p>
<h2>Viewing the Generated *.edmx File Data</h2>
<p>Now, let’s see exactly what the EDM Wizard generated for you. Right-click the InventoryEDM.edmx file in
the Solution Explorer and select the Open With... menu option. From the resulting dialog box, pick the
XML Editor option. This allows you to see the underlying XML data seen in the EDM designer. The
structure of this XML document is broken down into four parts; you can find all of them in the
&lt;edmx:Edmx&gt; root element.</p>
<p>The &lt;edmx:Runtime&gt; sub-elements define the XML data for your conceptual, physical, and mapping
layer models. First, you have the definition of the physical Inventory database table:</p>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="rem">&lt;!-- SSDL content --&gt;</span>
<span class="kwrd">&lt;</span><span class="html">edmx:StorageModels</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">Schema</span> <span class="attr">Namespace</span><span class="kwrd">="AutoLotModel.Store"</span> <span class="attr">Alias</span><span class="kwrd">="Self"</span>
        <span class="attr">Provider</span><span class="kwrd">="System.Data.SqlClient"</span>
        <span class="attr">ProviderManifestToken</span><span class="kwrd">="2008"</span>
        <span class="attr">xmlns:store</span>=
        <span class="kwrd">"http://schemas.microsoft.com/ado/2007/12/edm/EntityStoreSchemaGenerator"</span>
        <span class="attr">xmlns</span><span class="kwrd">="http://schemas.microsoft.com/ado/2009/02/edm/ssdl"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">EntityContainer</span> <span class="attr">Name</span><span class="kwrd">="AutoLotModelStoreContainer"</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">EntitySet</span> <span class="attr">Name</span><span class="kwrd">="Inventory"</span> <span class="attr">EntityType</span><span class="kwrd">="AutoLotModel.Store.Inventory"</span>
                <span class="attr">store:Type</span><span class="kwrd">="Tables"</span> <span class="attr">Schema</span><span class="kwrd">="dbo"</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">EntityContainer</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">EntityType</span> <span class="attr">Name</span><span class="kwrd">="Inventory"</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">Key</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">PropertyRef</span> <span class="attr">Name</span><span class="kwrd">="CarID"</span> <span class="kwrd">/&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">Key</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">Property</span> <span class="attr">Name</span><span class="kwrd">="CarID"</span> <span class="attr">Type</span><span class="kwrd">="int"</span> <span class="attr">Nullable</span><span class="kwrd">="false"</span> <span class="kwrd">/&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">Property</span> <span class="attr">Name</span><span class="kwrd">="Make"</span> <span class="attr">Type</span><span class="kwrd">="varchar"</span> <span class="attr">Nullable</span><span class="kwrd">="false"</span> <span class="attr">MaxLength</span><span class="kwrd">="50"</span> <span class="kwrd">/&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">Property</span> <span class="attr">Name</span><span class="kwrd">="Color"</span> <span class="attr">Type</span><span class="kwrd">="varchar"</span> <span class="attr">Nullable</span><span class="kwrd">="false"</span> <span class="attr">MaxLength</span><span class="kwrd">="50"</span> <span class="kwrd">/&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">Property</span> <span class="attr">Name</span><span class="kwrd">="PetName"</span> <span class="attr">Type</span><span class="kwrd">="varchar"</span> <span class="attr">MaxLength</span><span class="kwrd">="50"</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">EntityType</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">Schema</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">edmx:StorageModels</span><span class="kwrd">&gt;</span></pre>
<p>Note that the &lt;Schema&gt; node defines the name of the ADO.NET data provider that will use this
information when communicating with the database (System.Data.SqlClient). The &lt;EntityType&gt; node
marks the name of the physical database table, as well as each column in the table.</p>
<p>The next major chunk of the *.edmx file is the &lt;edmx:ConceptualModels&gt; element, which defines the
shaped client-side entities. Notice that the Cars entity defines the CarNickname property, which you
change using the designer:</p>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="rem">&lt;!-- CSDL content --&gt;</span>
<span class="kwrd">&lt;</span><span class="html">edmx:ConceptualModels</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">Schema</span> <span class="attr">Namespace</span><span class="kwrd">="AutoLotModel"</span> <span class="attr">Alias</span><span class="kwrd">="Self"</span>
        <span class="attr">xmlns:annotation</span><span class="kwrd">="http://schemas.microsoft.com/ado/2009/02/edm/annotation"</span>
        <span class="attr">xmlns</span><span class="kwrd">="http://schemas.microsoft.com/ado/2008/09/edm"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">EntityContainer</span>
            <span class="attr">Name</span><span class="kwrd">="AutoLotEntities"</span> <span class="attr">annotation:LazyLoadingEnabled</span><span class="kwrd">="true"</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">EntitySet</span> <span class="attr">Name</span><span class="kwrd">="Cars"</span> <span class="attr">EntityType</span><span class="kwrd">="AutoLotModel.Car"</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">EntityContainer</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">EntityType</span> <span class="attr">Name</span><span class="kwrd">="Car"</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">Key</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">PropertyRef</span> <span class="attr">Name</span><span class="kwrd">="CarID"</span> <span class="kwrd">/&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">Key</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">Property</span> <span class="attr">Name</span><span class="kwrd">="CarID"</span> <span class="attr">Type</span><span class="kwrd">="Int32"</span> <span class="attr">Nullable</span><span class="kwrd">="false"</span> <span class="kwrd">/&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">Property</span> <span class="attr">Name</span><span class="kwrd">="Make"</span> <span class="attr">Type</span><span class="kwrd">="String"</span> <span class="attr">Nullable</span><span class="kwrd">="false"</span> <span class="attr">MaxLength</span><span class="kwrd">="50"</span>
                <span class="attr">Unicode</span><span class="kwrd">="false"</span> <span class="attr">FixedLength</span><span class="kwrd">="false"</span> <span class="kwrd">/&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">Property</span> <span class="attr">Name</span><span class="kwrd">="Color"</span> <span class="attr">Type</span><span class="kwrd">="String"</span> <span class="attr">Nullable</span><span class="kwrd">="false"</span> <span class="attr">MaxLength</span><span class="kwrd">="50"</span>
                <span class="attr">Unicode</span><span class="kwrd">="false"</span> <span class="attr">FixedLength</span><span class="kwrd">="false"</span> <span class="kwrd">/&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">Property</span> <span class="attr">Name</span><span class="kwrd">="CarNickname"</span> <span class="attr">Type</span><span class="kwrd">="String"</span> <span class="attr">MaxLength</span><span class="kwrd">="50"</span>
                <span class="attr">Unicode</span><span class="kwrd">="false"</span> <span class="attr">FixedLength</span><span class="kwrd">="false"</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">EntityType</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">Schema</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">edmx:ConceptualModels</span><span class="kwrd">&gt;</span></pre>
<p>That brings you to the mapping layer, which the Mapping Details window (and the EF runtime) uses
to connect names in the conceptual model to the physical model:</p>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="rem">&lt;!-- C-S mapping content --&gt;</span>
<span class="kwrd">&lt;</span><span class="html">edmx:Mappings</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">Mapping</span> <span class="attr">Space</span><span class="kwrd">="C-S"</span>
        <span class="attr">xmlns</span><span class="kwrd">="http://schemas.microsoft.com/ado/2008/09/mapping/cs"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">EntityContainerMapping</span> <span class="attr">StorageEntityContainer</span><span class="kwrd">="AutoLotModelStoreContainer"</span>
        <span class="attr">CdmEntityContainer</span><span class="kwrd">="AutoLotEntities"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">EntitySetMapping</span> <span class="attr">Name</span><span class="kwrd">="Cars"</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">EntityTypeMapping</span> <span class="attr">TypeName</span><span class="kwrd">="AutoLotModel.Car"</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;</span><span class="html">MappingFragment</span> <span class="attr">StoreEntitySet</span><span class="kwrd">="Inventory"</span><span class="kwrd">&gt;</span>
                    <span class="kwrd">&lt;</span><span class="html">ScalarProperty</span> <span class="attr">Name</span><span class="kwrd">="CarID"</span> <span class="attr">ColumnName</span><span class="kwrd">="CarID"</span> <span class="kwrd">/&gt;</span>
                    <span class="kwrd">&lt;</span><span class="html">ScalarProperty</span> <span class="attr">Name</span><span class="kwrd">="Make"</span> <span class="attr">ColumnName</span><span class="kwrd">="Make"</span> <span class="kwrd">/&gt;</span>
                    <span class="kwrd">&lt;</span><span class="html">ScalarProperty</span> <span class="attr">Name</span><span class="kwrd">="Color"</span> <span class="attr">ColumnName</span><span class="kwrd">="Color"</span> <span class="kwrd">/&gt;</span>
                    <span class="kwrd">&lt;</span><span class="html">ScalarProperty</span> <span class="attr">Name</span><span class="kwrd">="CarNickname"</span> <span class="attr">ColumnName</span><span class="kwrd">="PetName"</span> <span class="kwrd">/&gt;</span>
                <span class="kwrd">&lt;/</span><span class="html">MappingFragment</span><span class="kwrd">&gt;&lt;/</span><span class="html">EntityTypeMapping</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">EntitySetMapping</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">EntityContainerMapping</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">Mapping</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">edmx:Mappings</span><span class="kwrd">&gt;</span></pre>
    <p>The last part of the *.edmx file is the &lt;Designer&gt; element, which is not used by the EF runtime. If you
view this data, you will see it contains instructions used by Visual Studio to display your entities on the
visual designer surface.</p>
<p>Again, ensure that you have compiled your project at least once and click the Show All Files button
of the Solution Explorer. Next, begin by drilling into the obj\Debug folder; and then drill into the
edmxResourcesToEmbed subdirectory. Here you will find three XML files that are based on the entirety of
your *.edmx file (see Figure 23-16).</p>
<img src="../Images/Figure23_16.png" alt="Figure 23-16" />
<p><b>Figure 23-16</b> You use the *.edmx file to generate three seperate XML files</p>
<p>The data in these files will be embedded as binary resources in your assembly. Thus, your .NET
application has all the information it needs to understand the conceptual, physical, and mapping layers
of the EDM.</p>
<h2>Viewing the Generated Source Code</h2>
<p>You are almost ready to author some code to use your EDM; before you do, however, you should check
out the generated C# code base. Open the Class View window and expand your default namespace. You
will see that, in addition to the Program class, the EDM Wizard generated an entity class (which you
renamed to Car) and another class named AutoLotEntities.</p>
<p>If you go to the Solution Explorer and expand the InventoryEDM.edmx node, you will see an IDEmaintained
file named InventoryEDM.Designer.cs. As with any IDE-maintained file, you should not
directly edit this file because the IDE will recreate it each time you compile. However, you can open this
file for viewing by double-clicking it.</p>
<p>The AutoLotEntities class extends the ObjectContext class, which (as you probably recall) is your
entry point to the EF programming model. The constructors of AutoLotEntities provide various ways for
you to feed in connection string data. The default constructor has been configured to read the
connection string data automatically from the wizard-generated App.config file:</p>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">public</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> AutoLotEntities : ObjectContext
{
    <span class="kwrd">public</span> AutoLotEntities() : <span class="kwrd">base</span>(<span class="str">"name=AutoLotEntities"</span>, <span class="str">"AutoLotEntities"</span>)
    {
        <span class="kwrd">this</span>.ContextOptions.LazyLoadingEnabled = <span class="kwrd">true</span>;
        OnContextCreated();
    }
...
}</pre>
<p>Next, notice that the Cars property of the AutoLotEntities class encapsulates the ObjectSet&lt;Car&gt;
data member. You can use this property to work with the EDM model to modify the physical back-end
database indirectly:</p>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">public</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> AutoLotEntities : ObjectContext
{
...
    <span class="kwrd">public</span> ObjectSet&lt;Car&gt; Cars
    {
        <span class="kwrd">get</span>
        {
            <span class="kwrd">if</span> ((_Cars == <span class="kwrd">null</span>))
            {
                _Cars = <span class="kwrd">base</span>.CreateObjectSet&lt;Car&gt;(<span class="str">"Cars"</span>);
            }
            <span class="kwrd">return</span> _Cars;
        }    
    }
    <span class="kwrd">private</span> ObjectSet&lt;Car&gt; _Cars;
}</pre>
<p><b>Note</b> You will also see various methods in your ObjectContext-derived classes that begin with AddTo. While
you can use them to add new entities to the ObjectSet&lt;T&gt; member variables, the preferred way to do this is
with the ObjectSet&lt;T&gt; member obtained from the strongly typed properties.</p>
<p>The last item of interest in the designer code file is the Car entity class. The bulk of the code for each
entity class is a collection of properties that model the shape of your conceptual model. Each of these
properties implement its set logic using a call to the static StructuralObject.SetValidValue() method of
the EF API.</p>
<p>Also, the set logic includes code that informs the EF runtime that the state of an entity has changed,
which is important because the ObjectContext must know about these changes to push updates to the
physical database.</p>
<p>In addition, the set logic makes calls on two partial methods. Recall that a C# partial method
provides a simple way to deal with change notifications in your applications. If you don’t implement a
partial method, it is ignored by the compiler and stripped away. Here is the implementation of the
CarNickname property of the Car entity class:</p>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">public</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> Car : EntityObject
{
...
    <span class="kwrd">public</span> global::System.String CarNickname
    {
        <span class="kwrd">get</span>
        {
            <span class="kwrd">return</span> _CarNickname;
        }
        <span class="kwrd">set</span>
        {
            OnCarNicknameChanging(value);
            ReportPropertyChanging(<span class="str">"CarNickname"</span>);
            _CarNickname = StructuralObject.SetValidValue(value, <span class="kwrd">true</span>);
            ReportPropertyChanged(<span class="str">"CarNickname"</span>);
            OnCarNicknameChanged();
        }
    }

    <span class="kwrd">private</span> global::System.String _CarNickname;
    <span class="kwrd">partial</span> <span class="kwrd">void</span> OnCarNicknameChanging(global::System.String value);
    <span class="kwrd">partial</span> <span class="kwrd">void</span> OnCarNicknameChanged();
}</pre>
<h2>Enhancing the Generated Source Code</h2>
<p>All of the designer generated classes have been declared with the partial keyword, which as you recall
allows you to implement a class across multiple C# code files. This is especially useful when working
with the EF programming model because it means you can add “real” methods to your entity classes
that help you model your business domain better.</p>
<p>In this example, you override the ToString() method of the Car entity class to return the state of the
entity with a well formatted string. You also complete the definitions of the partial
OnCarNicknameChanging() and OnCarNicknameChanged() methods to serve as simple diagnostic
notifications. You define the following partial class declaration in a new Car.cs file:</p>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">public</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> Car
{
    <span class="kwrd">public</span> <span class="kwrd">override</span> <span class="kwrd">string</span> ToString()
    {
        <span class="rem">// Since the PetName column could be empty, supply</span>
        <span class="rem">// the default name of **No Name**.</span>
        <span class="kwrd">return</span> <span class="kwrd">string</span>.Format(<span class="str">"{0} is a {1} {2} with ID {3}."</span>,
            <span class="kwrd">this</span>.CarNickname ?? <span class="str">"**No Name**"</span>,
            <span class="kwrd">this</span>.Color, <span class="kwrd">this</span>.Make, <span class="kwrd">this</span>.CarID);
    }

    <span class="kwrd">partial</span> <span class="kwrd">void</span> OnCarNicknameChanging(global::System.String value)
    {
        Console.WriteLine(<span class="str">"\t-&gt; Changing name to: {0}"</span>, value);
    }

    <span class="kwrd">partial</span> <span class="kwrd">void</span> OnCarNicknameChanged()
    {
        Console.WriteLine(<span class="str">"\t-&gt; Name of car has been changed!"</span>);
    }
}</pre>
<p>A friendly reminder: When you provide implementations to these partial methods, you can receive
notifications if the properties of the entity classes have changed or are being changed, but not when the
physical database has changed. If you need to know when the physical database has changed, you can
handle the SavingChanges event on your ObjectContext derived class.</p>
    </body></html>
   

