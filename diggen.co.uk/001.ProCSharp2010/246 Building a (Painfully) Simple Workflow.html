<!DOCTYPE HTML>
<html>
<head>
    <title></title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="../csharp.css" />
    <link rel="stylesheet" type="text/css" href="../master.css" />
</head>
<body>
<h1>Building a (Painfully) Simple Workflow</h1>
    <p>As you build a workflow-enabled application, you will undoubtedly notice that it “feels different” from
building a typical .NET application. For example, up until this point in the text, every code example
began by creating a new project workspace (most often a Console Application project) and involved
authoring code to represent the program at large. A WF application also consists of custom code;
however, in addition, you are building directly into the assembly a model of the business process itself.</p>
<p>Another aspect of WF which is quite different from other sorts of .NET applications is that a vast
majority of your workflows will be modeled in a declarative manner, using an XML-based grammar
named XAML. Much of the time, you will not need to directly author this markup, as the Visual Studio
2010 IDE will do so automatically as you work with the WF designer tools. This is a big change in
direction from the previous version of the WF API, which favored using C# code as the standard way to
model a workflow.</p>
<p><b>Note</b> Be aware that the XAML dialect used within WF is not identical to the XAML dialect used for WPF. You will
learn about the syntax and semantics of WPF XAML in Chapter 27, as unlike WF XAML, it is quite common to
directly edit designer-generated WPF XAML.</p>
<p>To get you into the workflow mindset, open Visual Studio 2010. From the New Project dialog box,
pick a new Workflow Console Application project named FirstWorkflowExampleApp (see Figure 26-1).</p>
<img src="../Images/Figure26_01.png" alt="Figure 26-1" />
<p><b>Figure 26-1</b> Creating a new console based workflow application</p>
<p>Now, consider Figure 26-2, which illustrates the initial workflow diagram generated by Visual Studio
2010. As you can see, there is not too much happening at this point, just a message telling you to drop
activities on the designer.</p>
<img src="../Images/Figure26_02.png" alt="Figure 26-2" />
<p><b>Figure 26-2</b> A workflow designer is a container for activities that model your business process</p>
<p>For this first simple test workflow, open the Visual Studio 2010 Toolbox, and locate the WriteLine
activity under the Primitives section (Figure 26-3).</p>
<img src="../Images/Figure26_03.png" alt="Figure 26-3" />
<p><b>Figure 26-3</b> The Toolbox will show you all the default activities of WF 4.0</p>
<p>Once you have located this activity, drag it onto of the designer’s drop target (be sure you drag it
directly onto the area which says Drop activity here), and enter a friendly double quoted string message
into the Text edit box Figure 26-4 shows one possible workflow.</p>
<img src="../Images/Figure26_04.png" alt="Figure 26-4" />
<p><b>Figure 26-4</b> The WriteLine activity will display text to a TextWriter, the console in this case</p>
<h2>Viewing the Underlying XAML</h2>
<p>Now, if you close the workflow designer, you can right click on Workflow1.xaml using the Solution
Explorer and pick the “View code” menu option. This will display the underlying XAML representation of
your workflow. As you can see, the root node of this XML-based document is &lt;Activity&gt;. In the opening
declaration of the root element, you will find a large number of XML namespace definitions, almost all of
which have the token clr-namespace embedded within.</p>
<p>As explained in more detail in Chapter 27, when a XAML file needs to reference the definitions of
.NET types contained in external assemblies (or a different namespace in the current assembly), you are
required to build a .NET to XAML mapping using the clr-namespace token:</p>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">&lt;</span><span class="html">configuration</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">system.web</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">compilation</span> <span class="attr">debug</span><span class="kwrd">="false"</span> <span class="attr">targetFramework</span><span class="kwrd">="4.0"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">system.web</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">system.serviceModel</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">behaviors</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;</span><span class="html">serviceBehaviors</span><span class="kwrd">&gt;</span>
                <span class="kwrd">&lt;&lt;</span><span class="html">Activity</span> <span class="attr">mc:Ignorable</span><span class="kwrd">="sap"</span> <span class="attr">x:Class</span><span class="kwrd">="FirstWorkflowExampleApp.Workflow1"</span>
    <span class="attr">xmlns</span><span class="kwrd">="http://schemas.microsoft.com/netfx/2009/xaml/activities"</span>
    <span class="attr">xmlns:mc</span><span class="kwrd">="http://schemas.openxmlformats.org/markup-compatibility/2006"</span>
    <span class="attr">xmlns:mv</span><span class="kwrd">="clr-namespace:Microsoft.VisualBasic;assembly=System"</span>
    <span class="attr">xmlns:mva</span><span class="kwrd">="clr-namespace:Microsoft.VisualBasic.Activities;assembly=System.Activities"</span>
    <span class="attr">xmlns:s</span><span class="kwrd">="clr-namespace:System;assembly=mscorlib"</span>
    <span class="attr">xmlns:s1</span><span class="kwrd">="clr-namespace:System;assembly=System"</span>
    <span class="attr">xmlns:s2</span><span class="kwrd">="clr-namespace:System;assembly=System.Xml"</span>
    <span class="attr">xmlns:s3</span><span class="kwrd">="clr-namespace:System;assembly=System.Core"</span>
    <span class="attr">xmlns:sa</span><span class="kwrd">="clr-namespace:System.Activities;assembly=System.Activities"</span>
    <span class="attr">xmlns:sad</span><span class="kwrd">="clr-namespace:System.Activities.Debugger;assembly=System.Activities"</span>
    <span class="attr">xmlns:sap</span><span class="kwrd">="http://schemas.microsoft.com/netfx/2009/xaml/activities/presentation"</span>
    <span class="attr">xmlns:scg</span><span class="kwrd">="clr-namespace:System.Collections.Generic;assembly=System"</span>
    <span class="attr">xmlns:scg1</span><span class="kwrd">="clr-namespace:System.Collections.Generic;assembly=System.ServiceModel"</span>
    <span class="attr">xmlns:scg2</span><span class="kwrd">="clr-namespace:System.Collections.Generic;assembly=System.Core"</span>
    <span class="attr">xmlns:scg3</span><span class="kwrd">="clr-namespace:System.Collections.Generic;assembly=mscorlib"</span>
    <span class="attr">xmlns:sd</span><span class="kwrd">="clr-namespace:System.Data;assembly=System.Data"</span>
    <span class="attr">xmlns:sl</span><span class="kwrd">="clr-namespace:System.Linq;assembly=System.Core"</span>
    <span class="attr">xmlns:st</span><span class="kwrd">="clr-namespace:System.Text;assembly=mscorlib"</span>
    <span class="attr">xmlns:x</span><span class="kwrd">="http://schemas.microsoft.com/winfx/2006/xaml"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">x:Members</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">x:Property</span> <span class="attr">Name</span><span class="kwrd">="MessageToShow"</span> <span class="attr">Type</span><span class="kwrd">="InArgument(x:String)"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">x:Members</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">sap:VirtualizedContainerService.HintSize</span><span class="kwrd">&gt;</span>
        251,240
    <span class="kwrd">&lt;/</span><span class="html">sap:VirtualizedContainerService.HintSize</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">mva:VisualBasic.Settings</span><span class="kwrd">&gt;</span>
        Assembly references and imported namespaces for internal implementation
    <span class="kwrd">&lt;/</span><span class="html">mva:VisualBasic.Settings</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">WriteLine</span> <span class="attr">sad:XamlDebuggerXmlReader</span>.<span class="attr">FileName</span>=
        <span class="kwrd">"C:\My Code\ FirstWorkflowExampleApp\Workflow1.xaml"</span>
        <span class="attr">sap:VirtualizedContainerService</span>.<span class="attr">HintSize</span><span class="kwrd">="211,200"</span> <span class="attr">Text</span><span class="kwrd">="[MessageToShow]"</span> <span class="kwrd">/&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">Activity</span><span class="kwrd">&gt;</span>behavior<span class="kwrd">&gt;</span>
                    <span class="rem">&lt;!-- To avoid disclosing metadata information,</span>
<span class="rem">                        set the value below to false and remove the</span>
<span class="rem">                        metadata endpoint above before deployment --&gt;</span>
                    <span class="kwrd">&lt;</span><span class="html">serviceMetadata</span> <span class="attr">httpGetEnabled</span><span class="kwrd">="true"</span><span class="kwrd">/&gt;</span>
                    <span class="rem">&lt;!-- To receive exception details in faults for debugging purposes,</span>
<span class="rem">                        set the value below to true.</span>
<span class="rem">                        Set to false before deployment to avoid</span>
<span class="rem">                        disclosing exception information --&gt;</span>
                    <span class="kwrd">&lt;</span><span class="html">serviceDebug</span> <span class="attr">includeExceptionDetailInFaults</span><span class="kwrd">="false"</span><span class="kwrd">/&gt;</span>
                <span class="kwrd">&lt;/</span><span class="html">behavior</span><span class="kwrd">&gt;</span>
            <span class="kwrd">&lt;/</span><span class="html">serviceBehaviors</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">behaviors</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">system.serviceModel</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">system.webServer</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">modules</span> <span class="attr">runAllManagedModulesForAllRequests</span><span class="kwrd">="true"</span><span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">system.webServer</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">configuration</span><span class="kwrd">&gt;</span></pre>
<p>The &lt;Activity&gt; element is the container of all other tasks which represent your workflow. Here, we
have only one other sub-activity, &lt;WriteLine&gt;. Notice that the Text attribute has been set based on the
data you entered in the workflow designer.</p>
<p>Now remember that when you are building workflows using Visual Studio 2010, you will typically
not be required to manually modify this markup. Using this designer (and the various WF-centric tools
integrated into Visual Studio 2010), you are able to model your process while the markup is generated by
the IDE. Because of this fact, this chapter will not dive into the details of WF XAML to any great degree.
However, feel free to view the markup generated by the IDE as you drag and drop activities onto the
designer (this will get you in the proper mindset for your examination of WPF).</p>
<p>In any case, the markup found in a XAML file always maps to “real“ types in a .NET assembly. For
example, each element in a XAML file (such as &lt;Activity&gt;) is a declarative way to define a .NET object
(such as System.Activities.Activity). Attributes which appear in the opening element definition map
to properties or events on the related class type. At runtime, your markup will be fed into a runtime
object model, where each element description will be used to set the state of the related .NET object.</p>
<p>Allowing us to define the structure of a workflow in a declarative manner using XAML has a number
of benefits, most notably tool support. For example, it is possible to host the same Visual Studio 2010
designer tools in a custom GUI application. By doing so, you can build a simple tool which can be used
by the non-programmers on your team to create the business processes they wish to have you implement
in your products. Their design can be saved as a *.xaml file and imported into your .NET projects.</p>
<p>Another compelling benefit of using markup to define a workflow is that it now becomes possible to
(easily) load in external XAML files into memory on the fly and thereby change how your business
process operates. For example, you could author code that reads a *.xaml file on the fly and hydrates the
related object model. Since your workflow logic is not hard-coded into your assembly, changing the
functionality of the business process could be as simple as changing the markup and restarting your application.</p>
<p>Do understand that WF is far more than a pretty designer that allows you to model the activities of a
business process. As you are building your WF diagram, your markup can always be extended using code
to represent the runtime behavior of your process. In fact, if you wanted to do so, you could avoid the
use of XAML all together and author the workflow using nothing but C#. If you were to this, however, you
would be back to the same basic issue of having a body of code that is not readily understandable to
non-technical staff.</p>
<p>If you were to run your application at this point, you would see your message display to the console
window:</p>
<pre class="cmdline">
First Workflow!
Press any key to continue . . .</pre>
<p>Fair enough; however, what started this workflow? And how were you able to ensure that the
console application stayed running long enough for the workflow to complete? The answers to these
questions require an understanding of the workflow runtime engine.</p>
    </body>
    </html>
 
      
   
