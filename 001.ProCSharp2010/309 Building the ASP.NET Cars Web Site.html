<!DOCTYPE HTML>
<html lang="en">
<head>
    <title></title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <link rel="stylesheet" type="text/css" href="../csharp.css" />
    <link rel="stylesheet" type="text/css" href="../master.css" />
</head>
<body>
<h1>Building the ASP.NET Cars Web Site</h1>
<p>Given that many of the “simple” controls look and feel so close to their Windows Forms counterparts, I
won’t bother to enumerate the details of the basic widgets (Buttons, Labels, TextBoxes, etc.). Rather, let’s
build a new website that illustrates working with several of the more exotic controls as well as the
ASP.NET master page model and aspects of the data binding engine. Specifically, this next example will
illustrate the following techniques:</p>
<ul>
 <li>Working with master pages</li>
  <li>Working with site map navigation</li>
  <li>Working with the GridView control</li>
  <li>Working with the Wizard control </li>
</ul>
<p>To begin, create an Empty Web Site project named AspNetCarsSite. Note that we are not yet
creating a new ASP.NET Web Site project, as this will add a number of starter files to the mix which we
have not yet examined. For this project, we will add what we need manually.</p>
<h2>Working with ASP.NET Master Pages</h2>
<p>Many websites provide a consistent look and feel across multiple pages (a common menu navigation
system, common header and footer content, company logo, etc.). Under ASP.NET 1.x, developers made
extensive use of s and custom web controls to define web content that was to be used across
multiple pages. While s and custom web controls are still a very valid option under ASP.NET,
we are also provided with master pages that complement these existing technologies.</p>
<p>Simply put, a master page is little more than an ASP.NET page that takes a *.master file extension.
On their own, master pages are not viewable from a client-side browser (in fact, the ASP.NET runtime
will not serve this flavor of web content). Rather, master pages define a common UI layout shared by all
pages (or a subset of pages) in your site.</p>
<p>As well, a *.master page will define various content placeholder areas that establish a region of UI
real estate other *.aspx files may plug into. As you will see, *.aspx files that plug their content into a
master file look and feel a bit different from the *.aspx files we have been examining. Specifically, this
flavor of an *.aspx file is termed a content page. Content pages are *.aspx files that do not define an
HTML &lt;form&gt; element (that is the job of the master page).</p>
<p>However, as far as the end user is concerned, a request is made to a given *.aspx file. On the web
server, the related *.master file and any related *.aspx content pages are blended into a single unified
HTML page declaration.</p>
<p>To illustrate the use of master pages and content pages, begin by inserting a new master page into
your website via the Website &gt; Add New Item menu selection (Figure 33-8 shows the resulting dialog box).</p>
<img src="../Images/Figure33_08.png" alt="Figure 33-08" />
<p><b>Figure 33-8</b> Inserting a new *.master file</p>
<p>The initial markup of the MasterPage.master file looks like the following:</p>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="asp">&lt;%@ Master Language="C#" AutoEventWireup="true"
    CodeFile="MasterPage.master.cs" Inherits="MasterPage" %&gt;</span>

<span class="kwrd">&lt;!</span><span class="html">DOCTYPE</span> <span class="attr">html</span> <span class="attr">PUBLIC</span> <span class="kwrd">"-//W3C//DTD XHTML 1.0 Transitional//EN"</span>
    <span class="kwrd">"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"</span><span class="kwrd">&gt;</span>

<span class="kwrd">&lt;</span><span class="html">html</span> <span class="attr">xmlns</span><span class="kwrd">="http://www.w3.org/1999/xhtml"</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">head</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">title</span><span class="kwrd">&gt;</span>Untitled Page<span class="kwrd">&lt;/</span><span class="html">title</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">asp:ContentPlaceHolder</span> <span class="attr">id</span><span class="kwrd">="head"</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">asp:ContentPlaceHolder</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">head</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">body</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">form</span> <span class="attr">id</span><span class="kwrd">="form1"</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">div</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">asp:ContentPlaceHolder</span> <span class="attr">id</span><span class="kwrd">="ContentPlaceHolder1"</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">asp:ContentPlaceHolder</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">form</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">body</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">html</span><span class="kwrd">&gt;</span></pre>
    <p>The first point of interest is the new &lt;%@Master%&gt; directive. For the most part, this directive supports
the same attributes as the &lt;%@Page%&gt; directive described in the previous chapter. Like Page types, a
master page derives from a specific base class, which in this case is MasterPage. If you were to open up
your related code file, you would find the following class definition:</p>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">public</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> MasterPage : System.Web.UI.MasterPage
{
    <span class="kwrd">protected</span> <span class="kwrd">void</span> Page_Load(<span class="kwrd">object</span> sender, EventArgs e)
    {
    }
}</pre>
<p>The other point of interest within the markup of the master is the &lt;asp:ContentPlaceHolder&gt;
definition. This region of a master page represents the area of the master that the UI widgets of the
related *.aspx content file may plug into, not the content defined by the master page itself.</p>
<p>If you do intend to plug in an *.aspx file within this region, the scope within the
&lt;asp:ContentPlaceHolder&gt; and &lt;/asp:ContentPlaceHolder&gt; tags will typically remain empty. However, if
you so choose, you are able to populate this area with various web controls that function as a default UI
to use in the event that a given *.aspx file in the site does not supply specific content. For this example,
assume that each *.aspx page in your site will indeed supply custom content, and therefore your
&lt;asp:ContentPlaceHolder&gt; elements will be empty.</p>
<p><b>Note</b> A *.master page may define as many content placeholders as necessary. As well, a single *.master
page may nest additional *.master pages.</p>
<p>You are able to build a common UI of a *.master file using the same Visual Studio 2010 designers
used to build *.aspx files. For this site, you will add a descriptive Label (to serve as a common welcome
message), an AdRotator control (which will randomly display one of two image files), and a TreeView
control (to allow the user to navigate to other areas of the site). Here is some possible markup:</p>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">&lt;</span><span class="html">html</span> <span class="attr">xmlns</span><span class="kwrd">="http://www.w3.org/1999/xhtml"</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">head</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">title</span><span class="kwrd">&gt;</span>Untitled Page<span class="kwrd">&lt;/</span><span class="html">title</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">asp:ContentPlaceHolder</span> <span class="attr">id</span><span class="kwrd">="head"</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">asp:ContentPlaceHolder</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">head</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">body</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">form</span> <span class="attr">id</span><span class="kwrd">="form1"</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">div</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">hr</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">asp:Label</span> <span class="attr">ID</span><span class="kwrd">="Label1"</span> <span class="attr">runat</span><span class="kwrd">="server"</span> <span class="attr">Font-Size</span><span class="kwrd">="XX-Large"</span>
            <span class="attr">Text</span><span class="kwrd">="Welcome to the ASP.NET Cars Super Site!"</span><span class="kwrd">&gt;&lt;/</span><span class="html">asp:Label</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">asp:AdRotator</span> <span class="attr">ID</span><span class="kwrd">="myAdRotator"</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">/&gt;</span>
        <span class="attr">&amp;nbsp;</span><span class="kwrd">&lt;</span><span class="html">br</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">br</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">asp:TreeView</span> <span class="attr">ID</span><span class="kwrd">="navigationTree"</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">asp:TreeView</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">hr</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">div</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">asp:ContentPlaceHolder</span> <span class="attr">id</span><span class="kwrd">="ContentPlaceHolder1"</span> <span class="attr">runat</span><span class="kwrd">="server"</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;/</span><span class="html">asp:ContentPlaceHolder</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">div</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">form</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">body</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">html</span><span class="kwrd">&gt;</span></pre>
    <p>Figure 33-9 shows the design time view of the current master page.</p>
<img src="../Images/Figure33_09.png" alt="Figure 33-09" />
<p><b>Figure 33-9</b> The *.master file’s shared UI</p>
<p>Feel free to enhance the look of your TreeView control by using the inline editor of the control and
selecting the Auto Format... link. For my example, I selected the Arrow theme from the resulting dialog
and ended up with the following control markup:</p>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">&lt;</span><span class="html">asp:TreeView</span> <span class="attr">ID</span><span class="kwrd">="navigationTree"</span> <span class="attr">runat</span><span class="kwrd">="server"</span>
        <span class="attr">ImageSet</span><span class="kwrd">="Arrows"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">HoverNodeStyle</span> <span class="attr">Font-Underline</span><span class="kwrd">="True"</span> <span class="attr">ForeColor</span><span class="kwrd">="#5555DD"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">NodeStyle</span> <span class="attr">Font-Names</span><span class="kwrd">="Verdana"</span> <span class="attr">Font-Size</span><span class="kwrd">="8pt"</span> <span class="attr">ForeColor</span><span class="kwrd">="Black"</span>
        <span class="attr">HorizontalPadding</span><span class="kwrd">="5px"</span> <span class="attr">NodeSpacing</span><span class="kwrd">="0px"</span> <span class="attr">VerticalPadding</span><span class="kwrd">="0px"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">ParentNodeStyle</span> <span class="attr">Font-Bold</span><span class="kwrd">="False"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">SelectedNodeStyle</span> <span class="attr">Font-Underline</span><span class="kwrd">="True"</span> <span class="attr">ForeColor</span><span class="kwrd">="#5555DD"</span>
        <span class="attr">HorizontalPadding</span><span class="kwrd">="0px"</span> <span class="attr">VerticalPadding</span><span class="kwrd">="0px"</span> <span class="kwrd">/&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">asp:TreeView</span><span class="kwrd">&gt;</span></pre>
    <h2>Working with the TreeView Control Site Navigation Logic</h2>
<p>ASP.NET ships with several web controls that allow you to handle site navigation: SiteMapPath, TreeView,
and Menu. As you would expect, these web widgets can be configured in multiple ways. For example, each
of these controls can dynamically generate its nodes via an external XML file (or an XML-based
*.sitemap file), programmatically generate nodes in code, or through markup using the designers of
Visual Studio 2010.</p>
<p>Your navigation system will be dynamically populated using a *.sitemap file. The benefit of this
approach is that we can define the overall structure of our website in an external file and then bind it to a
TreeView (or Menu) control on the fly. This way, if the navigational structure of your website changes, we
simply need to modify the *.sitemap file and reload the page. To begin, insert a new Web.sitemap file into your
project using the Website &gt; Add New Item menu option to bring up the dialog box shown in Figure 33-10.</p>
<img src="../Images/Figure33_10.png" alt="Figure 33-10" />
<p><b>Figure 33-10</b> Inserting a new Web.sitemap file</p>
<p>As you can see, the initial Web.sitemap file defines a topmost item with two subnodes:</p>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">&lt;?</span><span class="html">xml</span> <span class="attr">version</span><span class="kwrd">="1.0"</span> <span class="attr">encoding</span><span class="kwrd">="utf-8"</span> ?<span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">siteMap</span> <span class="attr">xmlns</span><span class="kwrd">="http://schemas.microsoft.com/AspNet/SiteMap-File-1.0"</span> <span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">siteMapNode</span> <span class="attr">url</span><span class="kwrd">=""</span> <span class="attr">title</span><span class="kwrd">=""</span> <span class="attr">description</span><span class="kwrd">=""</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">siteMapNode</span> <span class="attr">url</span><span class="kwrd">=""</span> <span class="attr">title</span><span class="kwrd">=""</span> <span class="attr">description</span><span class="kwrd">=""</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">siteMapNode</span> <span class="attr">url</span><span class="kwrd">=""</span> <span class="attr">title</span><span class="kwrd">=""</span> <span class="attr">description</span><span class="kwrd">=""</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">siteMapNode</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">siteMap</span><span class="kwrd">&gt;</span></pre>
    <p>If we were to bind this structure to a Menu control, we would find a topmost menu item with two
submenus. Therefore, when you wish to define subitems, simply define new &lt;siteMapNode&gt; elements
within the scope of an existing &lt;siteMapNode&gt;. In any case, the goal is to define the overall structure of
your website within a Web.sitemap file using various &lt;siteMapNode&gt; elements. Each one of these elements
can define a title and URL attribute. The URL attribute represents which *.aspx file to navigate to when
the user clicks a given menu item (or node of a TreeView). Your site map will contain three site map
nodes (underneath the top-level site map node), as follows:</p>
<ul>
 <li>Home: Default.aspx </li>
 <li>Build a Car: BuildCar.aspx</li>
 <li>View Inventory: Inventory.aspx</li>
</ul>
<p>Your menu system has a single topmost Welcome item with three subelements. Therefore, you can
update the Web.sitemap file as follows, but be aware that each url value must be unique (if not, you will
receive a runtime error):</p>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">&lt;</span><span class="html">Advertisements</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">Ad</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">ImageUrl</span><span class="kwrd">&gt;</span>SlugBug.jpg<span class="kwrd">&lt;/</span><span class="html">ImageUrl</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">TargetUrl</span><span class="kwrd">&gt;</span>http://www.Cars.com<span class="kwrd">&lt;/</span><span class="html">TargetUrl</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">AlternateText</span><span class="kwrd">&gt;</span>Your new Car?<span class="kwrd">&lt;/</span><span class="html">AlternateText</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">Impressions</span><span class="kwrd">&gt;</span>80<span class="kwrd">&lt;/</span><span class="html">Impressions</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">Ad</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">Ad</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">ImageUrl</span><span class="kwrd">&gt;</span>car.gif<span class="kwrd">&lt;/</span><span class="html">ImageUrl</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">TargetUrl</span><span class="kwrd">&gt;</span>http://www.CarSuperSite.com<span class="kwrd">&lt;/</span><span class="html">TargetUrl</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">AlternateText</span><span class="kwrd">&gt;</span>Like this Car?<span class="kwrd">&lt;/</span><span class="html">AlternateText</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">Impressions</span><span class="kwrd">&gt;</span>80<span class="kwrd">&lt;/</span><span class="html">Impressions</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">Ad</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">Advertisements</span><span class="kwrd">&gt;</span></pre>
    <p><b>Note</b> The ~/ prefix before each page in the url attribute is a notation that represents the root of the website.</p>
<p>Now, despite what you may be thinking, you do not associate a Web.sitemap file directly to a Menu or
TreeView control using a given property. Rather, the *.master or *.aspx file that contains the UI widget
that will display the Web.sitemap file must contain a SiteMapDataSource component. This type will
automatically load the Web.sitemap file into its object model when the page is requested. The Menu and
TreeView types then set their DataSourceID property to point to the SiteMapDataSource instance.</p>
<p>To add a new SiteMapDataSource to your *.master file and automatically set the DataSourceID
property, you can make use of the Visual Studio 2010 designer. Activate the inline editor of the TreeView
control (i.e., click the tiny arrow in the top-right corner of the TreeView) and select New Data Source, as
shown in Figure 33-11.</p>
<img src="../Images/Figure33_11.png" alt="Figure 33-11" />
<p><b>Figure 33-11</b> Adding a new SiteMapDataSource</p>
<p>From the resulting dialog box, select the SiteMap icon. This will set the DataSourceID property of the
Menu item as well as add a new SiteMapDataSource component to your page. This is all you need to do to
configure your TreeView control to navigate to the additional pages on your site. If you wish to perform
additional processing when the user selects a given menu item, you may do so by handling the
SelectedNodeChanged event. There is no need to do so for this example, but be aware that you are able to
determine which menu item was selected using the incoming event arguments.</p>
<h2>Establishing Bread Crumbs with the SiteMapPath Type</h2>
<p>Before moving on to the AdRotator control, add a SiteMapPath type (located in the Navigation tab in the
toolbox) onto your *.master file, beneath the content placeholder element. This widget will
automatically adjust its content based on the current selection of the menu system. As you may know,
this can provide a helpful visual cue for the end user (formally, this UI technique is termed
breadcrumbs). Once you complete this example, you will notice that when you select the Welcome &gt;
Build a Car menu item, the SiteMapPath widget updates accordingly automatically.</p>
<h2>Working with the AdRotator</h2>
<p>The role of the ASP.NET AdRotator widget is to randomly display a given image at some position in the
browser. Go ahead and add an AdRotator widget to the designer. Once you do, it is displayed as an empty
placeholder. Functionally, this control cannot do its magic until you assign the AdvertisementFile
property to point to the source file that describes each image. For this example, the data source will be a
simple XML file named Ads.xml.</p>
<p>To add the XML file to the Web site, go to the Website &gt; Add New Item menu option and select XML
file. Name the file Ads.xml and specify a unique &lt;Ad&gt; element for each image you wish to display. At
minimum, each &lt;Ad&gt; element specifies the image to display (ImageUrl), the URL to navigate to if the
image is selected (TargetUrl), mouseover text (AlternateText), and the weight of the ad (Impressions):</p>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">&lt;</span><span class="html">Advertisements</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">Ad</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">ImageUrl</span><span class="kwrd">&gt;</span>SlugBug.jpg<span class="kwrd">&lt;/</span><span class="html">ImageUrl</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">TargetUrl</span><span class="kwrd">&gt;</span>http://www.Cars.com<span class="kwrd">&lt;/</span><span class="html">TargetUrl</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">AlternateText</span><span class="kwrd">&gt;</span>Your new Car?<span class="kwrd">&lt;/</span><span class="html">AlternateText</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">Impressions</span><span class="kwrd">&gt;</span>80<span class="kwrd">&lt;/</span><span class="html">Impressions</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">Ad</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">Ad</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">ImageUrl</span><span class="kwrd">&gt;</span>car.gif<span class="kwrd">&lt;/</span><span class="html">ImageUrl</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">TargetUrl</span><span class="kwrd">&gt;</span>http://www.CarSuperSite.com<span class="kwrd">&lt;/</span><span class="html">TargetUrl</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">AlternateText</span><span class="kwrd">&gt;</span>Like this Car?<span class="kwrd">&lt;/</span><span class="html">AlternateText</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">Impressions</span><span class="kwrd">&gt;</span>80<span class="kwrd">&lt;/</span><span class="html">Impressions</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">Ad</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">Advertisements</span><span class="kwrd">&gt;</span></pre>
    <p>Here you have specified two image files (car.gif and slugbug.jpg). As a result, you will need to
ensure that these files are in the root of your website (these files have been included with this book’s
code download). To add them to your current project, select the Website &gt; Add Existing Item menu
option. At this point, you can associate your XML file to the AdRotator control via the AdvertisementFile
property (in the Properties window):</p>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">&lt;</span><span class="html">asp:AdRotator</span> <span class="attr">ID</span><span class="kwrd">="myAdRotator"</span> <span class="attr">runat</span><span class="kwrd">="server"</span>
    <span class="attr">AdvertisementFile</span><span class="kwrd">="~/Ads.xml"</span><span class="kwrd">/&gt;</span></pre>
    <p>Later when you run this application and post back to the page, you will be randomly presented with
one of two image files.</p>
<h2>Defining the Default Content Page</h2>
<p>Now that you have a master page established, you can begin designing the individual *.aspx pages that
will define the UI content to merge within the &lt;asp:ContentPlaceHolder&gt; tag of the master page. The
*.aspx files that are merged within a master page are called content pages and have a few key differences
from a normal, standalone ASP.NET web page.</p>
<p>In a nutshell, the *.master file defines the &lt;form&gt; section of the final HTML page. Therefore, the
existing &lt;form&gt; area within the *.aspx file will need to be replaced with an &lt;asp:Content&gt; scope. While
you could update the markup of your initial *.aspx file by hand, you can insert a new content page to
your project; simply right-click anywhere on the designer surface of the *.master file and select the Add
Content Page menu option. This will generate a new *.aspx file with the following initial markup:</p> 
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="asp">&lt;%@ Page Language="C#" MasterPageFile="~/MasterPage.master"
    AutoEventWireup="true" CodeFile="Default.aspx.cs"
    Inherits="_Default" Title="Untitled Page" %&gt;</span>

<span class="kwrd">&lt;</span><span class="html">asp:Content</span> <span class="attr">ID</span><span class="kwrd">="Content1"</span>
    <span class="attr">ContentPlaceHolderID</span><span class="kwrd">="head"</span> <span class="attr">Runat</span><span class="kwrd">="Server"</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">asp:Content</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;</span><span class="html">asp:Content</span> <span class="attr">ID</span><span class="kwrd">="Content2"</span>
    <span class="attr">ContentPlaceHolderID</span><span class="kwrd">="ContentPlaceHolder1"</span> <span class="attr">Runat</span><span class="kwrd">="Server"</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">asp:Content</span><span class="kwrd">&gt;</span></pre>
    <p>First, notice that the &lt;%@Page%&gt; directive has been updated with a new MasterPageFile attribute that
is assigned to your *.master file. Also note that rather than having a &lt;form&gt; element, we have an
&lt;asp:Content&gt; scope (currently empty) that has set the ContentPlaceHolderID value identical to the
&lt;asp:ContentPlaceHolder&gt; component in the master file.</p>
<p>Given these associations, the content page understands where to plug in its content, while the
master’s content is displayed in a read-only nature on the content page. There is no need to build a
complex UI for your Default.aspx content area. For this example, simply add some literal text that
provides some basic site instructions, as you see in Figure 33-12 (also notice on the upper right of the
content page that there is a link to switch to the related master file).</p>
<img src="../Images/Figure33_12.png" alt="Figure 33-12" />
<p><b>Figure 33-12</b> Authoring the first content page</p>
<p>Now, if you run your project, you will find that the UI content of the *.master and Default.aspx files
have been merged into a single stream of HTML. As you can see from Figure 33-13, the end user is
unaware that the master page even exists. Also, as you refresh the page (via the F5 key), you should see
the AdRotator randomly displaying one of two images.</p>
<img src="../Images/Figure33_13.png" alt="Figure 33-13" />
    <p><b>Figure 33-13</b> At runtime, master files and content pages render back a single form</p>
<p><b>Note</b> Do be aware that a Page object’s master page can be assigned programmatically within the PreInit
event of a Page derived type using the inherited Master property.</p>
<h2>Designing the Inventory Content Page</h2>
<p>To insert the Inventory.aspx content page into your current project, open the *.master page in the IDE,
select Website &gt; Add Content Page, and rename this file to Inventory.aspx. The role of the Inventory content
page is to display the contents of the Inventory table of the AutoLot database within a GridView control.</p>
<p>The ASP.NET GridView control has the ability to represent connection string data and SQL Select,
Insert, Update, and Delete statements (or alternatively stored procedures) in markup. Therefore, rather
than authoring all of the necessary ADO.NET code by hand, you can allow the SqlDataSource class to
generate the markup for you. Using the visual designers, you are able to assign the DataSourceID
property of the GridView to the SqlDataSource component.</p>
<p>With a few simple mouse clicks, you can configure the GridView to automatically select, update, and
delete records of the underlying data store. While this zero-code mindset greatly simplifies the amount
of boilerplate code, understand that this simplicity comes with a loss of control and may not be the best
approach for an enterprise-level application. This model can be wonderful for low-trafficked pages,
prototyping a website, or smaller in-house applications.</p>
<p>To illustrate how to work with the GridView (and the data access logic) in a declarative manner,
begin by updating the Inventory.aspx content page with a descriptive Label control. Next, open the
Server Explorer tool (via the View menu) and make sure you have added a data connection to the
AutoLot database created during your examination of ADO.NET (see Chapter 21 for a walkthrough of the
process of adding a data connection). Now, select the Inventory table in Server Explorer and drag it onto
the content area of the Inventory.aspx file. Once you have done so, the IDE responds by performing the
following steps:</p>
<ol>
 <li>Your web.config file was updated with a new &lt;connectionStrings&gt; element.</li>
 <li>A SqlDataSource component was configured with the necessary Select, Insert,
Update, and Delete logic.</li>
 <li>The DataSourceID property of the GridView has been set to the new
SqlDataSource component.</li>
</ol>
<p><b>Note</b> As an alternative, you can configure a GridView widget using the inline editor. Select New Data Source
from the Choose Data Source drop-down box. This will activate a wizard that walks you through a series of steps
to connect this component to the required data source.</p>
<p>If you examine the opening declaration of the GridView control, you will see that the DataSourceID
property has been set to the SqlDataSource you just defined:</p>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">&lt;</span><span class="html">asp:GridView</span> <span class="attr">ID</span><span class="kwrd">="GridView1"</span> <span class="attr">runat</span><span class="kwrd">="server"</span> <span class="attr">AutoGenerateColumns</span><span class="kwrd">="False"</span>
        <span class="attr">DataKeyNames</span><span class="kwrd">="CarID"</span> <span class="attr">DataSourceID</span><span class="kwrd">="SqlDataSource1"</span>
        <span class="attr">EmptyDataText</span><span class="kwrd">="There are no data records to display."</span><span class="kwrd">&gt;</span>

    <span class="kwrd">&lt;</span><span class="html">Columns</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">asp:BoundField</span> <span class="attr">DataField</span><span class="kwrd">="CarID"</span> <span class="attr">HeaderText</span><span class="kwrd">="CarID"</span> <span class="attr">ReadOnly</span><span class="kwrd">="True"</span>
                <span class="attr">SortExpression</span><span class="kwrd">="CarID"</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">asp:BoundField</span> <span class="attr">DataField</span><span class="kwrd">="Make"</span> <span class="attr">HeaderText</span><span class="kwrd">="Make"</span> <span class="attr">SortExpression</span><span class="kwrd">="Make"</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">asp:BoundField</span> <span class="attr">DataField</span><span class="kwrd">="Color"</span> <span class="attr">HeaderText</span><span class="kwrd">="Color"</span> <span class="attr">SortExpression</span><span class="kwrd">="Color"</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">asp:BoundField</span> <span class="attr">DataField</span><span class="kwrd">="PetName"</span> <span class="attr">HeaderText</span><span class="kwrd">="PetName"</span>
            <span class="attr">SortExpression</span><span class="kwrd">="PetName"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">Columns</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">asp:GridView</span><span class="kwrd">&gt;</span></pre>
    <p>The SqlDataSource type is where a majority of the action is taking place. In the markup that follows,
notice that this type has recorded the necessary SQL statements (with parameterized queries, no less) to
interact with the Inventory table of the AutoLot database. As well, using the $ syntax of the
ConnectionString property, this component will automatically read the &lt;connectionStrings&gt; value from
web.config:</p>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">&lt;</span><span class="html">asp:SqlDataSource</span> <span class="attr">ID</span><span class="kwrd">="SqlDataSource1"</span> <span class="attr">runat</span><span class="kwrd">="server"</span>
    <span class="attr">ConnectionString</span><span class="kwrd">="&lt;%$ ConnectionStrings:AutoLotConnectionString1 %&gt;"</span>
        <span class="attr">DeleteCommand</span><span class="kwrd">="DELETE FROM [Inventory] WHERE [CarID] = @CarID"</span>
        <span class="attr">InsertCommand</span><span class="kwrd">="INSERT INTO [Inventory] ([CarID], [Make], [Color], [PetName])
            VALUES (@CarID, @Make, @Color, @PetName)"</span>
        <span class="attr">ProviderName</span><span class="kwrd">="&lt;%$ ConnectionStrings:AutoLotConnectionString1.ProviderName %&gt;"</span>
        <span class="attr">SelectCommand</span><span class="kwrd">="SELECT [CarID], [Make], [Color], [PetName] FROM [Inventory]"</span>
        <span class="attr">UpdateCommand</span><span class="kwrd">="UPDATE [Inventory] SET [Make] = @Make,
            [Color] = @Color, [PetName] = @PetName WHERE [CarID] = @CarID"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">DeleteParameters</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">asp:Parameter</span> <span class="attr">Name</span><span class="kwrd">="CarID"</span> <span class="attr">Type</span><span class="kwrd">="Int32"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">DeleteParameters</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">UpdateParameters</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">asp:Parameter</span> <span class="attr">Name</span><span class="kwrd">="Make"</span> <span class="attr">Type</span><span class="kwrd">="String"</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">asp:Parameter</span> <span class="attr">Name</span><span class="kwrd">="Color"</span> <span class="attr">Type</span><span class="kwrd">="String"</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">asp:Parameter</span> <span class="attr">Name</span><span class="kwrd">="PetName"</span> <span class="attr">Type</span><span class="kwrd">="String"</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">asp:Parameter</span> <span class="attr">Name</span><span class="kwrd">="CarID"</span> <span class="attr">Type</span><span class="kwrd">="Int32"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">UpdateParameters</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">InsertParameters</span><span class="kwrd">&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">asp:Parameter</span> <span class="attr">Name</span><span class="kwrd">="CarID"</span> <span class="attr">Type</span><span class="kwrd">="Int32"</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">asp:Parameter</span> <span class="attr">Name</span><span class="kwrd">="Make"</span> <span class="attr">Type</span><span class="kwrd">="String"</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">asp:Parameter</span> <span class="attr">Name</span><span class="kwrd">="Color"</span> <span class="attr">Type</span><span class="kwrd">="String"</span> <span class="kwrd">/&gt;</span>
        <span class="kwrd">&lt;</span><span class="html">asp:Parameter</span> <span class="attr">Name</span><span class="kwrd">="PetName"</span> <span class="attr">Type</span><span class="kwrd">="String"</span> <span class="kwrd">/&gt;</span>
    <span class="kwrd">&lt;/</span><span class="html">InsertParameters</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">asp:SqlDataSource</span><span class="kwrd">&gt;</span></pre>
<p>At this point, you are able to run your web program, click the View Inventory menu item, and view
your data, as shown in Figure 33-14. (Note that I updated my DataView grid with a unique look and feel
using the inline designer.)</p>
<img src="../Images/Figure33_14.png" alt="Figure 33-14" />
<p><b>Figure 33-14</b> The zero-code model of the SqlDataSource component</p>
<h2>Enabling Sorting and Paging</h2>
<p>The GridView control can easily be configured for sorting (via column name hyperlinks) and paging (via
numeric or next/previous hyperlinks). To do so, activate the inline editor and check the appropriate
options, as shown in Figure 33-15.</p>
<img src="../Images/Figure33_15.png" alt="Figure 33-15" />
    <p><b>Figure 33-15</b> Enabling sorting and paging</p>
<p>When you run your page again, you will be able to sort your data by clicking the column names and
scrolling through your data via the paging links (provided you have enough records in the Inventory
table!).</p>
<h2>Enabling In-Place Editing</h2>
<p>The final detail of this page is to enable the GridView control’s support for in-place activation. Given that
your SqlDataSource already has the necessary Delete and Update logic, all you need to do is check the
Enable Deleting and Enable Editing check boxes of the GridView (see Figure 33-15 for a reference point).
Sure enough, when you navigate back to the Inventory.aspx page, you are able to edit and delete records
(as shown in Figure 33-16) and update the underlying Inventory table of the AutoLot database.</p>
<img src="../Images/Figure33_16.png" alt="Figure 33-16" />
    <p><b>Figure 33-16</b> Editing and deleting functionality</p>
<p><b>Note</b> Editing and deleting functionality</p>
<p><b>Note</b> Enabling in-place editing for a GridView requires that the database table be assigned a primary key. If
you do not see these options enabled, chances are you forgot to set CarID as the primary key of the Inventory table
within the AutoLot database.</p>
<h2>Designing the Build-a-Car Content Page</h2>
<p>The final task for this example is to design the BuildCar.aspx content page. Insert this file into the
current project (via the Website &gt; Add Content Page menu option). This new page will make use of the
ASP.NET Wizard web control, which provides a simple way to walk the end user through a series of
related steps. Here, the steps in question will simulate the act of building an automobile for purchase.</p>
<p>Place a descriptive Label and Wizard control onto the content area. Next, activate the inline editor
for the Wizard and click the Add/Remove WizardSteps link. Add a total of four steps, as shown in Figure
33-17.</p>
<img src="../Images/Figure33_17.png" alt="Figure 33-17" />
    <p><b>Figure 33-17</b> Configuring our wizard</p>
<p>Once you have defined these steps, you will notice that the Wizard defines an empty content area
where you can now drag and drop controls for the currently selected step. For this example, update each
step with the following UI elements (be sure to provide a fitting ID value for each item using the
Properties window):</p>
<ul>
 <li>Pick Your Model: A TextBox control</li>
 <li>Pick Your Color: A ListBox control</li>
 <li>Name Your Car: A TextBox control</li>
 <li>Delivery Date: A Calendar control</li>
</ul>
<p>The ListBox control is the only UI element of the Wizard that requires additional steps. Select this
item on the designer (making sure you first select the Pick Your Color link) and fill this widget with a set
of colors using the Items property of the Properties window. Once you do, you will find markup much
like the following within the scope of the Wizard definition:</p>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">&lt;</span><span class="html">asp:ListBox</span> <span class="attr">ID</span><span class="kwrd">="ListBoxColors"</span> <span class="attr">runat</span><span class="kwrd">="server"</span> <span class="attr">Width</span><span class="kwrd">="237px"</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">asp:ListItem</span><span class="kwrd">&gt;</span>Purple<span class="kwrd">&lt;/</span><span class="html">asp:ListItem</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">asp:ListItem</span><span class="kwrd">&gt;</span>Green<span class="kwrd">&lt;/</span><span class="html">asp:ListItem</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">asp:ListItem</span><span class="kwrd">&gt;</span>Red<span class="kwrd">&lt;/</span><span class="html">asp:ListItem</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">asp:ListItem</span><span class="kwrd">&gt;</span>Yellow<span class="kwrd">&lt;/</span><span class="html">asp:ListItem</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">asp:ListItem</span><span class="kwrd">&gt;</span>Pea Soup Green<span class="kwrd">&lt;/</span><span class="html">asp:ListItem</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">asp:ListItem</span><span class="kwrd">&gt;</span>Black<span class="kwrd">&lt;/</span><span class="html">asp:ListItem</span><span class="kwrd">&gt;</span>
    <span class="kwrd">&lt;</span><span class="html">asp:ListItem</span><span class="kwrd">&gt;</span>Lime Green<span class="kwrd">&lt;/</span><span class="html">asp:ListItem</span><span class="kwrd">&gt;</span>
<span class="kwrd">&lt;/</span><span class="html">asp:ListBox</span><span class="kwrd">&gt;</span></pre>
    <p>Now that you have defined each of the steps, you can handle the FinishButtonClick event for the
autogenerated Finish button. Be aware, however, that you won’t see this Finish button until you select
the final step of the wizard on the designer. Once you have selected the final step, simply double click on
the Finish button to generate the event handler. Within the server-side event handler, obtain the
selections from each UI element and build a description string that is assigned to the Text property of an
additional Label type named lblOrder:</p>
<!-- code formatted by http://manoli.net/csharpformat/ -->
<pre class="csharpcode">
<span class="kwrd">public</span> <span class="kwrd">partial</span> <span class="kwrd">class</span> Default2 : System.Web.UI.Page
{
    <span class="kwrd">protected</span> <span class="kwrd">void</span> Page_Load(<span class="kwrd">object</span> sender, EventArgs e)
    {
    }

    <span class="kwrd">protected</span> <span class="kwrd">void</span> carWizard_FinishButtonClick(<span class="kwrd">object</span> sender,
        System.Web.UI.WebControls.WizardNavigationEventArgs e)
    {
        <span class="rem">// Get each value.</span>
        <span class="kwrd">string</span> order = <span class="kwrd">string</span>.Format(<span class="str">"{0}, your {1} {2} will arrive on {3}."</span>,
        txtCarPetName.Text, ListBoxColors.SelectedValue,
        txtCarModel.Text,
        carCalendar.SelectedDate.ToShortDateString());
    
        <span class="rem">// Assign to label</span>
        lblOrder.Text = order;
    }
}</pre>
<p>At this point, your AspNetCarsSite web application is complete! Figure 33-18 shows the Wizard in
action.</p>
<img src="../Images/Figure33_18.png" alt="Figure 33-18" />
    <p><b>Figure 33-18</b> The Wizard control in action</p>
<p>That wraps up your first look of various ASP.NET web controls, master pages, content pages and site
map navigation. Next up, let’s look at the functionality of the ASP.NET validation controls.</p>
    </body>
    </html>
   
      
   
